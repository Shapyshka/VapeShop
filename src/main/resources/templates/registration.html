<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity3"
      xmlns:text-color="http://www.w3.org/1999/xhtml">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=0.6">

  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

  <link rel="icon" type="image/ico" href="https://www.vapeshifter.ru/favicon.ico">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css">
  <title>Регистрация - VapeShifter</title>
  <!-- Yandex.Metrika counter -->
  <script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(92179338, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true
   });
</script>
  <noscript><div><img src="https://mc.yandex.ru/watch/92179338" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
  <!-- /Yandex.Metrika counter -->
</head>

<body style="margin-top:70px; background-color:#eeeeee">
<header th:insert="blocks/header :: Header" ></header>
<br>
<div align="center" style="font-size:40px;">Регистрация</div>
<br>
<div align="center">
  <div align="center" style="width:70%; " class="card shadow-sm">
  <form th:action="@{/registration}" method="post" >
    <div><label style="font-size: 18px; width:60%;"> Логин: <input style="font-size: 18px;" type="text" th:value="${usern}" name="username" class="form-control" required/> </label></div>
    <div><label style="font-size: 18px; width:60%;"> Имя: <input style="font-size: 18px;" type="text" th:value="${fname}" name="firstname" class="form-control" required/> </label></div>
    <div><label style="font-size: 18px; width:60%;"> Фамилия: <input style="font-size: 18px;" type="text" th:value="${sname}" name="secondname" class="form-control" required/> </label></div>
    <div><label style="font-size: 18px; width:60%;"> Отчество (при наличии): <input style="font-size: 18px;" type="text" th:value="${mname}" name="middlename" class="form-control"/> </label></div>

    <div><label style="font-size: 18px; width:60%;"> Номер телефона: <input style="font-size: 18px;" type="tel" th:value="${fonum}" name="phonenumber" id="phonenumber" class="form-control" maxlength="50"
                                                                            autofocus="autofocus"
                                                                            pattern="\+7\s?[\(]{0,1}9[0-9]{2}[\)]{0,1}\s?\d{3}[-]{0,1}\d{2}[-]{0,1}\d{2}"
                                                                            placeholder="+7(___)___-__-__"  required/> </label></div>
    <div><label style="font-size: 18px; width:60%;"> Эл. почта: <input style="font-size: 18px;" type="email" th:value="${email}" name="email" class="form-control" required/> </label></div>
    <div><label style="font-size: 18px; width:60%;"> Дата рождения: <input style="font-size: 18px;" type="date" th:value="${#dates.format(birthday, 'yyyy-MM-dd')}" name="bday" class="form-control" required/> </label></div>

    <br>
    <div><label style="font-size: 18px; width:60%;"> Пароль: <input style="font-size: 18px;" type="password" th:value="${userp}" name="password" class="form-control" required/> </label></div>
  <!--  <div style="color:red" th:if = "${#fields.hasErrors('password')}" th:errors="*{text}"></div>-->
    <div><label style="font-size: 18px; width:60%;"> Повторите пароль: <input style="font-size: 18px;" type="password" name="password2" class="form-control" required/> </label></div>
    <br>
    <div align="center" style="width:70%">
      <div align="left">
        <input class="form-check-input" type="checkbox" style="display:inline-block;" id="politicscheck"/>
        <label class="form-check-label" for="politicscheck" style="font-size: 16px; display:inline-block; width:90%;"> Настоящим подтверждаю, что я ознакомлен и согласен с условиями <a target="_blank" href="/soglasiepersdata">политики обработки персональных данных</a>, подтверждаю, что являюсь совершеннолетним лицом (мне есть 18 лет).
        </label>
      </div>
    </div>

    <script language="JavaScript">
         document.getElementById('politicscheck').addEventListener('change', (event) => {
          if (event.currentTarget.checked) {
            document.getElementById('regbut').disabled=false;
          } else {
            document.getElementById('regbut').disabled=true;
          }
        })
    </script>

    <br>
    <div><input class="btn btn-success" id="regbut" style="font-size: 18px;" type="submit" value="Зарегистрироваться" disabled/></div>
    <a href="/login" style="font-size: 18px;">Уже есть аккаунт? Войдите!</a>
  <br>
    <div style="color:#ff0000; font-size: 18px;" th:if="${message}">
      <p th:text="${message}"></p>
    </div>
    <div style="height:10px"></div>

  </form>

    <script type="text/javascript">
  function setCursorPosition(pos, e) {
    e.focus();
    if (e.setSelectionRange) e.setSelectionRange(pos, pos);
    else if (e.createTextRange) {
      var range = e.createTextRange();
      range.collapse(true);
      range.moveEnd("character", pos);
      range.moveStart("character", pos);
      range.select()
    }
  }

  function mask(e) {
    //console.log('mask',e);
    var matrix = this.placeholder,// .defaultValue
        i = 0,
        def = matrix.replace(/\D/g, ""),
        val = this.value.replace(/\D/g, "");
    def.length >= val.length && (val = def);
    matrix = matrix.replace(/[_\d]/g, function(a) {
      return val.charAt(i++) || "_"
    });
    this.value = matrix;
    i = matrix.lastIndexOf(val.substr(-1));
    i < matrix.length && matrix != this.placeholder ? i++ : i = matrix.indexOf("_");
    setCursorPosition(i, this)
  }
  window.addEventListener("DOMContentLoaded", function() {
    var input = document.querySelector("#phonenumber");
    input.addEventListener("input", mask, false);
    input.focus();
    setCursorPosition(3, input);
  });
</script>
  </div>
</div>
<footer th:insert="blocks/footer :: Footer"></footer>

</body>
</html>