<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <link href="https://fonts.cdnfonts.com/css/sprite-graffiti" rel="stylesheet">
    <link rel="icon" href="https://i.imgur.com/Y0qpG6p.png">
    <title th:text = "${products.get(0).getTitle()+' - VapeShifter'}"></title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css">
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
    <link href="bootstrap/js/bootstrap.min.js" rel="stylesheet" media="screen">
    <link href="bootstrap/js/bootstrap-modal.js" rel="stylesheet" media="screen">
    <link href="bootstrap/js/bootstrap-transition.js" rel="stylesheet" media="screen">
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(92179338, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true
   });
</script>
    <noscript><div><img src="https://mc.yandex.ru/watch/92179338" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <style>
.switch {
  position: relative;
  display: inline-block;
  width: 60px;
  height: 34px;
}

.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #c40404;
  -webkit-transition: .4s;
  transition: .4s;
}

.slider:before {
  position: absolute;
  content: "üëéüèª";
  height: 26px;
  width: 26px;
  left: 4px;
  bottom: 4px;
  background-color: #555555;
  -webkit-transition: .4s;
  transition: .4s;
}

input:checked + .slider {
  background-color: #00d10a;

}

input:focus + .slider {
  box-shadow: 0 0 1px #00d10a;

}

input:checked + .slider:before {
  -webkit-transform: translateX(26px);
  -ms-transform: translateX(26px);
  transform: translateX(26px);
  content:"üëçüèª";
}

/* Rounded sliders */
.slider.round {
  border-radius: 34px;
}

.slider.round:before {
  border-radius: 50%;
}


        .loader {
          border: 16px solid #f3f3f3; /* Light grey */
          border-top: 16px solid #3498db; /* Blue */
          border-radius: 50%;
          width: 75px;
          height: 75px;
          animation: spin 2s linear infinite;
        }

        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
    </style>
</head>
<script language="JavaScript">
    if (screen.width<1280){
        document.write("<style>body{zoom:150%}</style>");
    }
</script>
<body style="margin-top:70px; background-color:#eeeeee">

<header th:insert="blocks/header :: Header" ></header>
<br>
<!--<h1 align="center">–ü–æ–¥—Ä–æ–±–Ω–æ</h1>-->
<div align="center">
    <div id="loader" style="background-color:#dddddd; width:20%" align="center" class="rounded">
        <div style="width:90%">
            <div class="loader"></div>

        </div>
    </div>
    <div th:each="el:${products}" id="cuntent" class="rounded" style="display:none" >
        <div class="container" >
            <div class="card">
                <div class="card-body">
                    <div class="card-title" align="center" style="font-size:40px;" th:text="${el.getTitle()}">–ö–∞—Ç–∞–ª–æ–≥</div>
                    <div class="row row-cols-sm-1 row-cols-lg-2 " >
                        <div class="col mt-3" align="center" style="width:40%" >
                            <div class="white-box text-center">
                                <img th:if="${curusname=='anonymousUser'}" th:src="${el.getPhotoUrl()}" width="75%" style="object-fit:contain; filter: blur(10px);" class="img-thumbnail ">



                                <div th:if="${curusname!='anonymousUser'}">
                                    <a href="#" data-toggle="modal" th:data-target="${'#modalimg'+el.getId().toString()}">
                                        <img th:src="${el.getPhotoUrl()}" width="75%" style="object-fit:contain; " class="img-thumbnail ">
                                    </a>

                                    <div class="modal fade" th:id="${'modalimg'+el.getId().toString()}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabe3" aria-hidden="true">
                                        <div class="modal-dialog modal-lg" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body" align="center" >
                                                    <img th:src="${el.getPhotoUrl()}" width="90%" style="object-fit:contain; " class="img-thumbnail ">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>



                            </div>
                        </div>

                        <div class="col mt-3" style="width:60%">
                            <div class="row row-cols-2" >
                                <div class="col" align="left" style="width:60%">
                                    <h5 class="box-title">–û–ø–∏—Å–∞–Ω–∏–µ:</h5>
                                    <div th:utext="${#strings.unescapeJava(#strings.replace(#strings.escapeJava(el.getText()),'\n','&lt;br /&gt;'))}" style="font-size:18px"></div>
                                <br>
                                </div>

                                <div class="col" align="left"  style="white-space: nowrap; width:40%">
                                    <div th:if="${el.getVolume()!=null}">
                                        <h5 class="box-title">–û–±—ä–µ–º:</h5>
                                        <div th:text="${el.getVolume()+' –º–ª.'}" style="font-size:19px; "/>
                                        <br>
                                    </div>
                                    <div th:if="${el.getNicotine()!=null}">
                                        <h5 class="box-title"style="white-space: normal;">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –Ω–∏–∫–æ—Ç–∏–Ω–∞:</h5>
                                        <div th:text="${el.getNicotine()+'%'}" style="font-size:19px; "/>
                                        <br>
                                    </div>

                                    <div th:if="${el.getQuantity()!=null}">
                                        <h5 class="box-title ">–í –Ω–∞–ª–∏—á–∏–∏:</h5>
                                        <div th:text="${el.getQuantity()+' —à—Ç.'}" style="font-size:19px; "/>
                                        <br>
                                    </div>

                                    <h5 class="box-title">–¶–µ–Ω–∞:</h5>
                                    <div style="white-space: nowrap;">
                                        <div style="display:inline-block;">
                                            <h4  class="text-dark mb-0" th:text="${el.getPrice()+' ‚ÇΩ  '}" style="white-space: nowrap;"/>
                                        </div>
                                        <div th:if="${el.getOldprice()!=null}"  style="color:#FF0000; text-decoration: line-through; display:inline-block;">
                                            <span th:text="${el.getOldprice()+' ‚ÇΩ'}" style="font-size:16px; color:#777777; "/>
                                        </div>
                                    </div>
                                    <div align="left" class="mt-3">
                                        <div th:if="${el.getQuantity()==0}">
                                            <button type="button" class="btn btn-sm btn-outline-dark" style="display: inline-block; vertical-align: text-top; margin-bottom:10px; font-size:22px; white-space: nowrap; " disabled>
                                                    <span class="material-symbols-outlined" style="font-size:20px;">
                                                        shopping_cart
                                                    </span>
                                                –í –∫–æ—Ä–∑–∏–Ω—É
                                            </button>
                                        </div>
                                        <div th:if="${el.getQuantity()!=0}">

                                            <a type="button" th:if="${curusname=='anonymousUser'}" class="btn btn-sm btn-dark" href="/prf" style="display: inline-block; vertical-align: text-top; margin-bottom:10px; font-size:22px; white-space: nowrap; ">
                                                <span class="material-symbols-outlined" style="font-size:20px;">
                                                    shopping_cart
                                                </span>
                                                –í –∫–æ—Ä–∑–∏–Ω—É
                                            </a>

                                            <a type="button" th:if="${curusname!='anonymousUser'}" class="btn btn-sm btn-dark" href="#" data-toggle="modal" data-target="#modalcart" style="display: inline-block; vertical-align: text-top; margin-bottom:10px; font-size:22px; white-space: nowrap; ">
                                                <span class="material-symbols-outlined" style="font-size:20px;">
                                                    shopping_cart
                                                </span>
                                                –í –∫–æ—Ä–∑–∏–Ω—É
                                            </a>

                                            <div class="modal fade" id="modalcart" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel2" aria-hidden="true">
                                                <div class="modal-dialog" role="document">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title" id="exampleModalLabel2">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</h5>
                                                            <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close">
                                                            </button>
                                                        </div>

                                                        <iframe name="dummyframe" id="dummyframe" style="display: none;"></iframe>
                                                        <form th:action="'/products/'+${el.getId()}+'/addcart'" th:object="${cart}" method="post" target="dummyframe">
                                                            <div class="modal-body" align="center" >
                                                                <div class="card shadow-sm">

                                                                    <img th:src="${el.getPhotoUrl()}" class="" height="200" width="100%" style="object-fit:contain;"/>
                                                                    <div class="card-body">
                                                                        <div >
                                                                            <div align="left" class="mb-0" th:text="${el.getTitle()}" style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; font-size:17px; color:#222222; "></div>
                                                                            <div style="height:5px"> </div>
                                                                            <div align="left" style="white-space: nowrap;">
                                                                                <div style="display:inline-block;">
                                                                                    <h5  class="text-dark mb-0" th:text="${el.getPrice()+' ‚ÇΩ  '}" style="white-space: nowrap;"/>
                                                                                </div>
                                                                                <div th:if="${el.getOldprice()!=null}"  style="color:#FF0000; text-decoration: line-through; display:inline-block;">
                                                                                    <span th:text="${el.getOldprice()+' ‚ÇΩ'}" style="font-size:14px; color:#777777; "/>
                                                                                </div>
                                                                            </div>
                                                                            <div align="left" th:if="${el.getQuantity()!=null}">
                                                                                <i class="mb-0" th:text="${'–í –Ω–∞–ª–∏—á–∏–∏: '+el.getQuantity()+' —à—Ç.'}" style="font-size:15px; color:#444444; "></i>
                                                                            </div>
                                                                            <div style="height:15px"> </div>
                                                                        </div>
                                                                        –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:
                                                                        <input type="number" min="1" th:max="${el.getQuantity()}" name="quantity" id ="quantity" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" value="1" class="form-control" required>

                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                                                                <button type="submit" class="btn btn-dark" data-toggle="modal" data-target="#modalcart">
                                                                                     <span class="material-symbols-outlined" style="font-size:15px">
                                                                                     shopping_cart
                                                                                     </span>–î–æ–±–∞–≤–∏—Ç—å
                                                                </button>

                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>

                    </div>


                </div>
            </div>
        </div>
    </div>
    <script th:inline="javascript">document.getElementById("cuntent").style.display = "block";</script>

    <script>document.getElementById("loader").style.display = "none";</script>

    <br>
    <div align="center" style="font-size:35px;">–û—Ç–∑—ã–≤—ã</div>
    <br>
    <div align="center" style="font-size:28px;" th:if="${cartrep.findByUser_idAndProduct_IdAndStatus(userrep.findByUsername(curusname), productsrep.findById(id), 'inOrder').size()==0}">–ß—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤ - –∑–∞–∫–∞–∂–∏—Ç–µ —Ç–æ–≤–∞—Ä</div>
    <div align="center" style="width:66%" class="card shadow-sm" id="commentform" th:if="${cartrep.findByUser_idAndProduct_IdAndStatus(userrep.findByUsername(curusname), productsrep.findById(id), 'inOrder').size()!=0}">
        <div align="center">
            <div align="center" style="width:80%">
            <form method="post" style="align:center" th:action="'/products/'+${id}+'/comment'" th:object="${comment}">
                <br>
                <div align="center" style="font-size:20px;">–í—ã –∑–∞–∫–∞–∑—ã–≤–∞–ª–∏ –¥–∞–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä. –•–æ—Ç–∏—Ç–µ –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤?</div>
                <br>
                <div align="center" style="font-size:18px;">–û—Ü–µ–Ω–∫–∞:</div>
                <div align="center">
                    <label class="switch">
                        <input type="checkbox" name="rating" id="rating" checked>
                        <span class="slider round"></span>
                    </label>
                </div>
            <div style="height:15px"></div>
                <input type="text" maxlength="512" name="text" id ="text" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" class="form-control">
                <div style="height:15px"></div>
                <button style="color:#ffffff" class="btn btn-success" type="submit">
                    –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                </button>
        </form>
        <br>
        </div>
        </div>
    </div>

    <div th:if="${comments.size==0}" align="center" style="font-size:25px;">
        <br>
        –ù–µ—Ç –æ—Ç–∑—ã–≤–æ–≤
    </div>
    <div align="center" th:each="el:${comments}">
        <br>
        <div class="rounded shadow-sm" align="center" style="background-color:#ffffff; width:66%">
            <table width="100%">
                <tr>
                    <td align="center" width="15%">

                    </td>
                    <td align="center" width="70%">
                        <a style="color:#222222; text-decoration: none;" th:if="${curusname=='admin'}"  th:href="'/users/'+${el.getAuthorName()}" >
                            <img class="rounded-circle" th:src="${userrep.findByUsername(el.getAuthorName()).getAvatarlink()}" style="display:inline-block;" height="25px" width="25px" >
                            <h4 th:text="${el.getAuthorName()}" style="display:inline-block;"/>
                        </a>
                        <div style="color:#222222; text-decoration: none;" th:if="${curusname!='admin'}" >
                            <img class="rounded-circle" th:src="${userrep.findByUsername(el.getAuthorName()).getAvatarlink()}" style="display:inline-block;" height="25px" width="25px" >
                            <h4 th:text="${el.getAuthorName()}" style="display:inline-block;"/>
                        </div>
                    </td>
                    <td align="center" width="15%">
                        <div th:if="${el.getAuthorName()==curusname}">
                            <a type="button" class="btn btn-outline-danger" href="#" data-toggle="modal" th:data-target="${'#modal'+el.getId().toString()}">
                                <span class="material-symbols-outlined" style="font-size:16px;">
                                    close
                                </span>
                            </a>

                            <div class="modal fade" th:id="${'modal'+el.getId().toString()}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="exampleModalLabel">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h5>
                                            <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close">
                                            </button>
                                        </div>
                                        <div class="modal-body" align="center" >
                                            –í—ã —É–≤–µ—Ä–µ–Ω—ã —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –æ—Ç–∑—ã–≤?
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                                            <form th:action="'/products/comment/'+${el.getId()}+'/del'" method="post">
                                                <button type="submit" class="btn btn-danger">
                                                         <span class="material-symbols-outlined" style="font-size:15px">
                                                         delete
                                                         </span>–£–¥–∞–ª–∏—Ç—å
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
            </table>

                        <script th:inline="javascript">
                            /*<![CDATA[*/
                                if([[${el.getAuthorName()==curusname}]]){
                                    document.getElementById("commentform").style.display = "none";
                                }
                            /*]]>*/
                        </script>
            <div style="font-size: 16px;" th:text="${df2.format(df1.parse(el.getDate().toString()))}"></div>

            <div style="font-size: 20px;" th:if="${el.getRating()}" >
                <div style="display:inline-block; vertical-align:text-top;">
                    –û—Ü–µ–Ω–∫–∞:
                </div>
                <span style="color:#00d10a; display:inline-block; vertical-align:text-top;" class="material-symbols-outlined">
                    thumb_up
                </span>
            </div>
            <div style="font-size: 20px; " th:if="${!el.getRating()}" >
                <div style="display:inline-block; vertical-align:text-top;">
                    –û—Ü–µ–Ω–∫–∞:
                </div>
                <span style="color:#c40404; display:inline-block; vertical-align:text-top;" class="material-symbols-outlined">
                    thumb_down
                </span>
            </div>

            <div style="font-size:18px" th:if="${el.getText().length()!=0}">
                –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:
            </div>
            <div style="font-size: 22px;" th:text="${el.getText()}"></div>
            <h2> </h2>
        </div>
    </div>
</div>
<footer th:insert="blocks/footer :: Footer"></footer>
</body>
</html>